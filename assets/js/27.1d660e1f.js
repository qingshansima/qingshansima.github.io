(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{353:function(e,t,a){"use strict";a.r(t);var o=a(7),n=Object(o.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"教程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#教程"}},[e._v("#")]),e._v(" 教程")]),e._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),t("p",[e._v("使用pip安装openpyxl。建议在Python虚拟环境中执行此操作")]),e._v(" "),t("p",[e._v("没有系统包:")]),e._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("pip "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" openpyxl\n")])])]),t("p",[e._v(".. note::")]),e._v(" "),t("p",[e._v("支持流行的“lxml”_库，如果已安装。这在创建大文件时特别有用。")]),e._v(" "),t("p",[e._v(".. _lxml: http://lxml.de")]),e._v(" "),t("p",[e._v(".. warning::")]),e._v(" "),t("p",[e._v('为了能够将图像（jpeg、png、bmp…）包含到openpyxl文件中，\n您还需要安装的"pillow"库')]),e._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("    pip "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" pillow\n")])])]),t("p",[e._v("或浏览器打开 https://pypi.python.org/pypi/Pillow/，选择最新版本下载安装。")]),e._v(" "),t("p",[e._v("Working with a checkout\n+++++++++++++++++++++++")]),e._v(" "),t("p",[e._v("Sometimes you might want to work with the checkout of a particular version.\nThis may be the case if bugs have been fixed but a release has not yet been\nmade.")]),e._v(" "),t("p",[e._v(".. parsed-literal::\n$ pip install -e hg+https://foss.heptapod.net/openpyxl/openpyxl/@\\ |version|\\ #egg=openpyxl")]),e._v(" "),t("h2",{attrs:{id:"create-a-workbook"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-workbook"}},[e._v("#")]),e._v(" Create a workbook")]),e._v(" "),t("p",[e._v("There is no need to create a file on the filesystem to get started with openpyxl.\nJust import the :class:"),t("code",[e._v("Workbook")]),e._v(" class and start work::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> from openpyxl import Workbook\n>>> wb = Workbook()\n")])])]),t("p",[e._v("A workbook is always created with at least one worksheet. You can get it by\nusing the :obj:"),t("code",[e._v("Workbook.active")]),e._v(" property::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> ws = wb.active\n")])])]),t("p",[e._v(".. note::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("This is set to 0 by default. Unless you modify its value, you will always\nget the first worksheet by using this method.\n")])])]),t("p",[e._v("You can create new worksheets using the :meth:"),t("code",[e._v("Workbook.create_sheet")]),e._v(" method::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v('>>> ws1 = wb.create_sheet("Mysheet") # insert at the end (default)\n# or\n>>> ws2 = wb.create_sheet("Mysheet", 0) # insert at first position\n# or\n>>> ws3 = wb.create_sheet("Mysheet", -1) # insert at the penultimate position\n')])])]),t("p",[e._v("Sheets are given a name automatically when they are created.\nThey are numbered in sequence (Sheet, Sheet1, Sheet2, ...).\nYou can change this name at any time with the :obj:"),t("code",[e._v("Worksheet.title")]),e._v(" property::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v('ws.title = "New Title"\n')])])]),t("p",[e._v("Once you gave a worksheet a name, you can get it as a key of the workbook::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v('>>> ws3 = wb["New Title"]\n')])])]),t("p",[e._v("You can review the names of all worksheets of the workbook with the\n:obj:"),t("code",[e._v("Workbook.sheetname")]),e._v(" attribute ::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> print(wb.sheetnames)\n['Sheet2', 'New Title', 'Sheet1']\n")])])]),t("p",[e._v("You can loop through worksheets ::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> for sheet in wb:\n...     print(sheet.title)\n")])])]),t("p",[e._v("You can create copies of worksheets "),t("strong",[e._v("within a single workbook")]),e._v(":")]),e._v(" "),t("p",[e._v(":meth:"),t("code",[e._v("Workbook.copy_worksheet")]),e._v(" method::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> source = wb.active\n>>> target = wb.copy_worksheet(source)\n")])])]),t("p",[e._v(".. note::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("Only cells (including values, styles, hyperlinks and comments) and\ncertain worksheet attributes (including dimensions, format and\nproperties) are copied. All other workbook / worksheet attributes\nare not copied - e.g. Images, Charts.\n\nYou also **cannot** copy worksheets between workbooks. You cannot copy\na worksheet if the workbook is open in `read-only` or `write-only`\nmode.\n")])])]),t("h2",{attrs:{id:"playing-with-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playing-with-data"}},[e._v("#")]),e._v(" Playing with data")]),e._v(" "),t("p",[e._v("Accessing one cell\n++++++++++++++++++")]),e._v(" "),t("p",[e._v("Now we know how to get a worksheet, we can start modifying cells content.\nCells can be accessed directly as keys of the worksheet::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> c = ws['A4']\n")])])]),t("p",[e._v("This will return the cell at A4, or create one if it does not exist yet.\nValues can be directly assigned::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> ws['A4'] = 4\n")])])]),t("p",[e._v("There is also the :meth:"),t("code",[e._v("Worksheet.cell")]),e._v(" method.")]),e._v(" "),t("p",[e._v("This provides access to cells using row and column notation::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> d = ws.cell(row=4, column=2, value=10)\n")])])]),t("p",[e._v(".. note::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("When a worksheet is created in memory, it contains no `cells`. They are\ncreated when first accessed.\n")])])]),t("p",[e._v(".. warning::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("Because of this feature, scrolling through cells instead of accessing them\ndirectly will create them all in memory, even if you don't assign them a value.\n\nSomething like ::\n\n    >>> for x in range(1,101):\n    ...        for y in range(1,101):\n    ...            ws.cell(row=x, column=y)\n\nwill create 100x100 cells in memory, for nothing.\n")])])]),t("p",[e._v("Accessing many cells\n++++++++++++++++++++")]),e._v(" "),t("p",[e._v("Ranges of cells can be accessed using slicing::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> cell_range = ws['A1':'C2']\n")])])]),t("p",[e._v("Ranges of rows or columns can be obtained similarly::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> colC = ws['C']\n>>> col_range = ws['C:D']\n>>> row10 = ws[10]\n>>> row_range = ws[5:10]\n")])])]),t("p",[e._v("You can also use the :meth:"),t("code",[e._v("Worksheet.iter_rows")]),e._v(" method::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> for row in ws.iter_rows(min_row=1, max_col=3, max_row=2):\n...    for cell in row:\n...        print(cell)\n<Cell Sheet1.A1>\n<Cell Sheet1.B1>\n<Cell Sheet1.C1>\n<Cell Sheet1.A2>\n<Cell Sheet1.B2>\n<Cell Sheet1.C2>\n")])])]),t("p",[e._v("Likewise the :meth:"),t("code",[e._v("Worksheet.iter_cols")]),e._v(" method will return columns::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> for col in ws.iter_cols(min_row=1, max_col=3, max_row=2):\n...     for cell in col:\n...         print(cell)\n<Cell Sheet1.A1>\n<Cell Sheet1.A2>\n<Cell Sheet1.B1>\n<Cell Sheet1.B2>\n<Cell Sheet1.C1>\n<Cell Sheet1.C2>\n")])])]),t("p",[e._v(".. note::")]),e._v(" "),t("p",[e._v("For performance reasons the :obj:"),t("code",[e._v("Worksheet.iter_cols()")]),e._v(" method is not available in read-only mode.")]),e._v(" "),t("p",[e._v("If you need to iterate through all the rows or columns of a file, you can instead use the\n:obj:"),t("code",[e._v("Worksheet.rows")]),e._v(" property::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> ws = wb.active\n>>> ws['C9'] = 'hello world'\n>>> tuple(ws.rows)\n((<Cell Sheet.A1>, <Cell Sheet.B1>, <Cell Sheet.C1>),\n(<Cell Sheet.A2>, <Cell Sheet.B2>, <Cell Sheet.C2>),\n(<Cell Sheet.A3>, <Cell Sheet.B3>, <Cell Sheet.C3>),\n(<Cell Sheet.A4>, <Cell Sheet.B4>, <Cell Sheet.C4>),\n(<Cell Sheet.A5>, <Cell Sheet.B5>, <Cell Sheet.C5>),\n(<Cell Sheet.A6>, <Cell Sheet.B6>, <Cell Sheet.C6>),\n(<Cell Sheet.A7>, <Cell Sheet.B7>, <Cell Sheet.C7>),\n(<Cell Sheet.A8>, <Cell Sheet.B8>, <Cell Sheet.C8>),\n(<Cell Sheet.A9>, <Cell Sheet.B9>, <Cell Sheet.C9>))\n")])])]),t("p",[e._v("or the :obj:"),t("code",[e._v("Worksheet.columns")]),e._v(" property::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> tuple(ws.columns)\n((<Cell Sheet.A1>,\n<Cell Sheet.A2>,\n<Cell Sheet.A3>,\n<Cell Sheet.A4>,\n<Cell Sheet.A5>,\n<Cell Sheet.A6>,\n...\n<Cell Sheet.B7>,\n<Cell Sheet.B8>,\n<Cell Sheet.B9>),\n(<Cell Sheet.C1>,\n<Cell Sheet.C2>,\n<Cell Sheet.C3>,\n<Cell Sheet.C4>,\n<Cell Sheet.C5>,\n<Cell Sheet.C6>,\n<Cell Sheet.C7>,\n<Cell Sheet.C8>,\n<Cell Sheet.C9>))\n")])])]),t("p",[e._v(".. note::")]),e._v(" "),t("p",[e._v("For performance reasons the :obj:"),t("code",[e._v("Worksheet.columns")]),e._v(" property is not available in read-only mode.")]),e._v(" "),t("p",[e._v("Values only\n+++++++++++")]),e._v(" "),t("p",[e._v("If you just want the values from a worksheet you can use the :obj:"),t("code",[e._v("Worksheet.values")]),e._v(" property.\nThis iterates over all the rows in a worksheet but returns just the cell values::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("for row in ws.values:\n   for value in row:\n     print(value)\n")])])]),t("p",[e._v("Both :meth:"),t("code",[e._v("Worksheet.iter_rows")]),e._v(" and :meth:"),t("code",[e._v("Worksheet.iter_cols")]),e._v(" can\ntake the :code:"),t("code",[e._v("values_only")]),e._v(" parameter to return just the cell's value::")]),e._v(" "),t("blockquote",[t("blockquote",[t("blockquote",[t("p",[e._v("for row in ws.iter_rows(min_row=1, max_col=3, max_row=2, values_only=True):\n...   print(row)")])])])]),e._v(" "),t("p",[e._v("(None, None, None)\n(None, None, None)")]),e._v(" "),t("h2",{attrs:{id:"data-storage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#data-storage"}},[e._v("#")]),e._v(" Data storage")]),e._v(" "),t("p",[e._v("Once we have a :class:"),t("code",[e._v("Cell")]),e._v(", we can assign it a value::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> c.value = 'hello, world'\n>>> print(c.value)\n'hello, world'\n\n>>> d.value = 3.14\n>>> print(d.value)\n3.14\n")])])]),t("p",[e._v("Saving to a file\n++++++++++++++++")]),e._v(" "),t("p",[e._v("The simplest and safest way to save a workbook is by using the\n:func:"),t("code",[e._v("Workbook.save")]),e._v(" method of the :class:"),t("code",[e._v("Workbook")]),e._v(" object::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> wb = Workbook()\n>>> wb.save('balances.xlsx')\n")])])]),t("p",[e._v(".. warning::")]),e._v(" "),t("p",[e._v("This operation will overwrite existing files without warning.")]),e._v(" "),t("p",[e._v(".. note::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("The filename extension is not forced to be xlsx or xlsm, although you might have\nsome trouble opening it directly with another application if you don't\nuse an official extension.\n\nAs OOXML files are basically ZIP files, you can also  open it with your\nfavourite ZIP archive manager.\n")])])]),t("p",[e._v("If required, you can specify the attribute "),t("code",[e._v("wb.template=True")]),e._v(", to save a workbook\nas a template::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> wb = load_workbook('document.xlsx')\n>>> wb.template = True\n>>> wb.save('document_template.xltx')\n")])])]),t("p",[e._v("Saving as a stream\n++++++++++++++++++")]),e._v(" "),t("p",[e._v("If you want to save the file to a stream, e.g. when using a web application\nsuch as Pyramid, Flask or Django then you can simply provide a\n:func:"),t("code",[e._v("NamedTemporaryFile")]),e._v("::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> from tempfile import NamedTemporaryFile\n>>> from openpyxl import Workbook\n>>> wb = Workbook()\n>>> with NamedTemporaryFile() as tmp:\n        wb.save(tmp.name)\n        tmp.seek(0)\n        stream = tmp.read()\n")])])]),t("p",[e._v(".. warning::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("You should monitor the data attributes and document extensions\nfor saving documents in the document templates and vice versa,\notherwise the result table engine can not open the document.\n")])])]),t("p",[e._v(".. note::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("The following will fail::\n\n>>> wb = load_workbook('document.xlsx')\n>>> # Need to save with the extension *.xlsx\n>>> wb.save('new_document.xlsm')\n>>> # MS Excel can't open the document\n>>>\n>>> # or\n>>>\n>>> # Need specify attribute keep_vba=True\n>>> wb = load_workbook('document.xlsm')\n>>> wb.save('new_document.xlsm')\n>>> # MS Excel will not open the document\n>>>\n>>> # or\n>>>\n>>> wb = load_workbook('document.xltm', keep_vba=True)\n>>> # If we need a template document, then we must specify extension as *.xltm.\n>>> wb.save('new_document.xlsm')\n>>> # MS Excel will not open the document\n")])])]),t("h2",{attrs:{id:"loading-from-a-file"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#loading-from-a-file"}},[e._v("#")]),e._v(" Loading from a file")]),e._v(" "),t("p",[e._v("You can use the :func:"),t("code",[e._v("openpyxl.load_workbook")]),e._v(" to open an existing workbook::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v(">>> from openpyxl import load_workbook\n>>> wb = load_workbook(filename = 'empty_book.xlsx')\n>>> sheet_ranges = wb['range names']\n>>> print(sheet_ranges['D18'].value)\n3\n")])])]),t("p",[e._v(".. note ::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("There are several flags that can be used in load_workbook.\n\n- `data_only` controls whether cells with formulae have either the\n  formula (default) or the value stored the last time Excel read the sheet.\n\n- `keep_vba` controls whether any Visual Basic elements are preserved or\n  not (default). If they are preserved they are still not editable.\n")])])]),t("p",[e._v(".. warning ::")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("openpyxl does currently not read all possible items in an Excel file so\nshapes will be lost from existing files if they are opened and saved with\nthe same name.\n")])])]),t("h2",{attrs:{id:"errors-loading-workbooks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#errors-loading-workbooks"}},[e._v("#")]),e._v(" Errors loading workbooks")]),e._v(" "),t("p",[e._v("Sometimes openpyxl will fail to open a workbook. This is usually because there is something wrong with the file.\nIf this is the case then openpyxl will try and provide some more information. Openpyxl follows the OOXML specification closely and will reject files that do not because they are invalid. When this happens you can use the exception from openpyxl to inform the developers of whichever application or library produced the file. As the OOXML specification is publicly available it is important that developers follow it.")]),e._v(" "),t("p",[e._v("You can find the spec by searching for ECMA-376, most of the implementation specifics are in Part 4.")]),e._v(" "),t("p",[e._v("This ends the tutorial for now, you can proceed to the :doc:"),t("code",[e._v("usage")]),e._v(" section")])])}),[],!1,null,null,null);t.default=n.exports}}]);