<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用Go开发Web应用程序 | 土肥猿的面经园地</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="程序员的面经园地和知识仓库">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.8a73fe64.css" as="style"><link rel="preload" href="/assets/js/app.7d1116cd.js" as="script"><link rel="preload" href="/assets/js/2.f6c26bfc.js" as="script"><link rel="preload" href="/assets/js/3.7a437186.js" as="script"><link rel="preload" href="/assets/js/23.d4182788.js" as="script"><link rel="prefetch" href="/assets/js/10.046d08d1.js"><link rel="prefetch" href="/assets/js/11.5c5abcc8.js"><link rel="prefetch" href="/assets/js/12.f62d9829.js"><link rel="prefetch" href="/assets/js/13.4da237a9.js"><link rel="prefetch" href="/assets/js/14.48133eb7.js"><link rel="prefetch" href="/assets/js/15.48a2e085.js"><link rel="prefetch" href="/assets/js/16.81c035c3.js"><link rel="prefetch" href="/assets/js/17.5efa7f95.js"><link rel="prefetch" href="/assets/js/18.86e07264.js"><link rel="prefetch" href="/assets/js/19.2c2a487d.js"><link rel="prefetch" href="/assets/js/20.c4ffcb54.js"><link rel="prefetch" href="/assets/js/21.51a48402.js"><link rel="prefetch" href="/assets/js/22.bf514554.js"><link rel="prefetch" href="/assets/js/24.4dbd20f7.js"><link rel="prefetch" href="/assets/js/25.700af0f5.js"><link rel="prefetch" href="/assets/js/26.ae7d5d12.js"><link rel="prefetch" href="/assets/js/27.1d660e1f.js"><link rel="prefetch" href="/assets/js/28.e301b416.js"><link rel="prefetch" href="/assets/js/29.0fd72cb1.js"><link rel="prefetch" href="/assets/js/30.63cb3594.js"><link rel="prefetch" href="/assets/js/31.e64cb78c.js"><link rel="prefetch" href="/assets/js/32.fe425a1c.js"><link rel="prefetch" href="/assets/js/33.27558bfc.js"><link rel="prefetch" href="/assets/js/34.d0b64862.js"><link rel="prefetch" href="/assets/js/4.9ccfb5d5.js"><link rel="prefetch" href="/assets/js/5.573dfa2c.js"><link rel="prefetch" href="/assets/js/6.655bfde6.js"><link rel="prefetch" href="/assets/js/7.babcfb3d.js"><link rel="prefetch" href="/assets/js/8.71593ea4.js"><link rel="prefetch" href="/assets/js/9.b9ccbf27.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8a73fe64.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/FatMonkey550.png" alt="土肥猿的面经园地" class="logo"> <span class="site-name can-hide">土肥猿的面经园地</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经园地" class="dropdown-title"><a href="/pages/b5188c/" class="link-title">面经园地</a> <span class="title" style="display:none;">面经园地</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/interView/java/001/" class="nav-link">Java基础面试高频问题1~80</a></li><li class="dropdown-subitem"><a href="/pages/interView/java/002/" class="nav-link">Spring面试高频问题1~10</a></li><li class="dropdown-subitem"><a href="/pages/interView/java/003/" class="nav-link">MyBatis面试高频问题1~18</a></li><li class="dropdown-subitem"><a href="/pages/interView/java/004/" class="nav-link">Java架构师面试高频问题</a></li></ul></li><li class="dropdown-item"><h4>Dotnet</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/interView/DotNet/001/" class="nav-link">Dotnet面试题汇总1</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/interView/DB/001/" class="nav-link">Oracle面试题1-33</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发笔记" class="dropdown-title"><a href="/pages/43f8ea/" class="link-title">开发笔记</a> <span class="title" style="display:none;">开发笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>架构设计</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/43f8ea/" class="nav-link">面向对象设计五大原则</a></li><li class="dropdown-subitem"><a href="/pages/e08693/" class="nav-link">微服务常用组件</a></li></ul></li><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/Notes/java/001/" class="nav-link">Java常用中间件</a></li><li class="dropdown-subitem"><a href="/pages/Notes/java/002/" class="nav-link">Java常用工作流</a></li></ul></li><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/Notes/Python/miniServer/000/" class="nav-link">面向测试方法开发Python微服务</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中文翻译" class="dropdown-title"><!----> <span class="title" style="display:;">中文翻译</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Go语言文档中文翻译</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/GoTour/000/" class="nav-link">序言和目录</a></li><li class="dropdown-subitem"><a href="/pages/GoTour/001/" class="nav-link">Go语言的下载和安装</a></li><li class="dropdown-subitem"><a href="/pages/GoTour/002/" class="nav-link">Go语言入门教程</a></li><li class="dropdown-subitem"><a href="/pages/GoTour/003/" class="nav-link">Go模块教程</a></li><li class="dropdown-subitem"><a href="/pages/GoTour/004/" class="nav-link">使用Go和Gin开发RESTful API</a></li><li class="dropdown-subitem"><a href="/pages/GoTour/005/" aria-current="page" class="nav-link router-link-exact-active router-link-active">使用Go开发Web应用程序</a></li></ul></li><li class="dropdown-item"><h4>Python-PyAutoGui文档中文翻译</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/python/PyAutoGui/001/" class="nav-link">1.Windows11下PyAutoGui的安装和使用</a></li></ul></li><li class="dropdown-item"><h4>微软UI自动化文档中文翻译</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/Microsoft/UIAutomation/000/" class="nav-link">UI自动化课程简介</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="职场随笔" class="dropdown-title"><a href="/pages/893e69/" class="link-title">职场随笔</a> <span class="title" style="display:none;">职场随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>失业笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/unemploymentLog/Day000/" class="nav-link">2003清明，失业第0天</a></li><li class="dropdown-subitem"><a href="/pages/unemploymentLog/Day001/" class="nav-link">2003-04-06，失业第一周·第1天</a></li><li class="dropdown-subitem"><a href="/pages/unemploymentLog/Day002/" class="nav-link">2003-04-07，失业第一周·第2天</a></li><li class="dropdown-subitem"><a href="/pages/unemploymentLog/Day003/" class="nav-link">2003-04-08~09，失业第一周·双休</a></li><li class="dropdown-subitem"><a href="/pages/unemploymentLog/Day004/" class="nav-link">2003-04-08~09，失业第二周·第1天</a></li></ul></li></ul></div></div> <a href="https://github.com/qingshansima/qingshansima.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经园地" class="dropdown-title"><a href="/pages/b5188c/" class="link-title">面经园地</a> <span class="title" style="display:none;">面经园地</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/interView/java/001/" class="nav-link">Java基础面试高频问题1~80</a></li><li class="dropdown-subitem"><a href="/pages/interView/java/002/" class="nav-link">Spring面试高频问题1~10</a></li><li class="dropdown-subitem"><a href="/pages/interView/java/003/" class="nav-link">MyBatis面试高频问题1~18</a></li><li class="dropdown-subitem"><a href="/pages/interView/java/004/" class="nav-link">Java架构师面试高频问题</a></li></ul></li><li class="dropdown-item"><h4>Dotnet</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/interView/DotNet/001/" class="nav-link">Dotnet面试题汇总1</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/interView/DB/001/" class="nav-link">Oracle面试题1-33</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发笔记" class="dropdown-title"><a href="/pages/43f8ea/" class="link-title">开发笔记</a> <span class="title" style="display:none;">开发笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>架构设计</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/43f8ea/" class="nav-link">面向对象设计五大原则</a></li><li class="dropdown-subitem"><a href="/pages/e08693/" class="nav-link">微服务常用组件</a></li></ul></li><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/Notes/java/001/" class="nav-link">Java常用中间件</a></li><li class="dropdown-subitem"><a href="/pages/Notes/java/002/" class="nav-link">Java常用工作流</a></li></ul></li><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/Notes/Python/miniServer/000/" class="nav-link">面向测试方法开发Python微服务</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中文翻译" class="dropdown-title"><!----> <span class="title" style="display:;">中文翻译</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Go语言文档中文翻译</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/GoTour/000/" class="nav-link">序言和目录</a></li><li class="dropdown-subitem"><a href="/pages/GoTour/001/" class="nav-link">Go语言的下载和安装</a></li><li class="dropdown-subitem"><a href="/pages/GoTour/002/" class="nav-link">Go语言入门教程</a></li><li class="dropdown-subitem"><a href="/pages/GoTour/003/" class="nav-link">Go模块教程</a></li><li class="dropdown-subitem"><a href="/pages/GoTour/004/" class="nav-link">使用Go和Gin开发RESTful API</a></li><li class="dropdown-subitem"><a href="/pages/GoTour/005/" aria-current="page" class="nav-link router-link-exact-active router-link-active">使用Go开发Web应用程序</a></li></ul></li><li class="dropdown-item"><h4>Python-PyAutoGui文档中文翻译</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/python/PyAutoGui/001/" class="nav-link">1.Windows11下PyAutoGui的安装和使用</a></li></ul></li><li class="dropdown-item"><h4>微软UI自动化文档中文翻译</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/Microsoft/UIAutomation/000/" class="nav-link">UI自动化课程简介</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="职场随笔" class="dropdown-title"><a href="/pages/893e69/" class="link-title">职场随笔</a> <span class="title" style="display:none;">职场随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>失业笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/unemploymentLog/Day000/" class="nav-link">2003清明，失业第0天</a></li><li class="dropdown-subitem"><a href="/pages/unemploymentLog/Day001/" class="nav-link">2003-04-06，失业第一周·第1天</a></li><li class="dropdown-subitem"><a href="/pages/unemploymentLog/Day002/" class="nav-link">2003-04-07，失业第一周·第2天</a></li><li class="dropdown-subitem"><a href="/pages/unemploymentLog/Day003/" class="nav-link">2003-04-08~09，失业第一周·双休</a></li><li class="dropdown-subitem"><a href="/pages/unemploymentLog/Day004/" class="nav-link">2003-04-08~09，失业第二周·第1天</a></li></ul></li></ul></div></div> <a href="https://github.com/qingshansima/qingshansima.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div class="sidebar-slot sidebar-slot-top">
  <a href="http://apifox.cn/a103xugaoyi" target="_blank">
    <img src="https://cdn.staticaly.com/gh/xugaoyi/blog-gitalk-comment@master/img/431669861564_.2470ykdcpbds.jpg" alt="npm" class="no-zoom" style="width: 100%;border-radius: 2px;">
    <p style="text-align: center;margin: 0;color: #999;font-size: 12px;">(进入注册为作者充电)</p>
  </a></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Go语言文档中文翻译</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/GoTour/000/" class="sidebar-link">序言和目录</a></li><li><a href="/pages/GoTour/001/" class="sidebar-link">Go语言的下载和安装</a></li><li><a href="/pages/GoTour/002/" class="sidebar-link">Go语言入门教程</a></li><li><a href="/pages/GoTour/003/" class="sidebar-link">Go模块教程</a></li><li><a href="/pages/GoTour/004/" class="sidebar-link">教程：使用Go和Gin开发RESTful API</a></li><li><a href="/pages/GoTour/005/" aria-current="page" class="active sidebar-link">使用Go开发Web应用程序</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python-PyAutoGui文档中文翻译</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/python/PyAutoGui/001/" class="sidebar-link">01.Windows11下PyAutoGui的安装和使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>微软UIAutomation文档翻译.md</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/Microsoft/UIAutomation/000/" class="sidebar-link">UI自动化课程简介</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>openpyxl文档中文翻译.md</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/Python/openpyxlDoc/000/" class="sidebar-link">openpyxl文档中文翻译</a></li><li><a href="/pages/720440/" class="sidebar-link">课程·安装</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><span data-v-06970110>中文翻译</span></li><li data-v-06970110><span data-v-06970110>Go语言文档中文翻译</span></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://qingshansima.github.io" target="_blank" title="作者" class="beLink" data-v-06970110>飞翔的土肥猿</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2023-04-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">使用Go开发Web应用程序<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h4 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h4> <p>本教程涵盖以下内容：</p> <ul><li>使用加载和保存方法创建数据结构</li> <li>使用net/http包构建web应用程序</li> <li>使用html/template包处理html模板</li> <li>使用regexp包验证用户输入</li> <li>使用闭包</li></ul> <p>前置知识：</p> <ul><li>编程经验</li> <li>了解基本的web技术（HTTP、HTML）</li> <li>一些UNIX/DOS命令行知识</li></ul> <h4 id="入门"><a href="#入门" class="header-anchor">#</a> 入门</h4> <p>目前，您需要有一台FreeBSD、Linux、macOS或Windows机器才能运行Go。我们将使用$来表示命令提示符。</p> <p>安装Go（请参阅<a href="/pages/GoTour/001/">安装说明</a>）。</p> <p>在GOPATH中为本教程创建一个新目录，并进入该目录：</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token variable">$mkdir</span> gowiki
<span class="token variable">$cd</span> gowiki
</code></pre></div><p>创建一个名为wiki.go的文件，在您喜欢的编辑器中打开它，然后添加以下行：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;fmt&quot;</span>
 <span class="token string">&quot;io/ioutil&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>我们从Go标准库导入fmt和ioutil包。稍后，当我们实现附加功能时，我们将向该导入声明添加更多的包。</p> <h4 id="数据结构"><a href="#数据结构" class="header-anchor">#</a> 数据结构</h4> <p>让我们从定义数据结构开始。wiki由一系列相互连接的页面组成，每个页面都有一个标题和一个正文（页面内容）。在这里，我们将Page定义为一个结构，其中有两个字段表示标题和正文。</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Page <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Title <span class="token builtin">string</span>
    Body  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>
</code></pre></div><p>类型 []byte 的意思是“一个字节切片”。（有关切片的更多信息，请参阅<a href="http://docscn.studygolang.com/doc/articles/slices_usage_and_internals.html" target="_blank" rel="noopener noreferrer">Slices: usage and internals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。）Body元素是[]字节，而不是字符串，因为这是我们将使用的io库所期望的类型，如下所示。</p> <p>Page结构描述了页面数据将如何存储在内存中。但是持久存储呢？我们可以通过在Page上创建一个保存方法来解决这个问题.</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Page<span class="token punctuation">)</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    filename <span class="token operator">:=</span> p<span class="token punctuation">.</span>Title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
    <span class="token keyword">return</span> ioutil<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Body<span class="token punctuation">,</span> <span class="token number">0600</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此方法的签名写道：“这是一个名为save的方法，它以指向Page的指针p作为接收器。它不接受参数，并返回类型为error的值。”</p> <p>此方法将把页面的正文保存到一个文本文件中。为了简单起见，我们将使用标题作为文件名。</p> <p>save方法返回一个错误值，因为这是WriteFile（一个向文件写入字节片的标准库函数）的返回类型。save方法返回错误值，以便在写入文件时出现任何错误时由应用程序进行处理。如果一切顺利，Page.save（）将返回nil（指针、接口和其他类型的零值）。</p> <p>作为WriteFile的第三个参数传递的八进制整数文本0600表示，创建该文件时应仅具有当前用户的读写权限。（有关详细信息，请参阅Unix手册页打开（2）。）</p> <p>除了保存页面外，我们还需要加载页面：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Page <span class="token punctuation">{</span>
    filename <span class="token operator">:=</span> title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
    body<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> body<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数loadPage从title参数构造文件名，将文件内容读取到新的变量体中，并返回一个指针，指向用正确的title和body值构造的Page文本。</p> <p>函数可以返回多个值。标准库函数io.ReadFile返回[]字节和错误。在loadPage中，错误尚未得到处理；由下划线（_）符号表示的“空白标识符”用于丢弃错误返回值（本质上，不将值赋值）。</p> <p>但是如果ReadFile遇到错误会发生什么呢？例如，该文件可能不存在。我们不应该忽视这些错误。让我们修改函数以返回*Page和error。</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Page<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    filename <span class="token operator">:=</span> title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
    body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> body<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此函数的调用方现在可以检查第二个参数；如果为零，则它已成功加载页面。如果没有，那么这将是一个可以由调用者处理的错误（有关详细信息，请参阅语言规范）。</p> <p>在这一点上，我们有一个简单的数据结构和保存到文件和从文件加载的能力。让我们编写一个主要函数来测试我们所写的内容：</p> <p>编译并执行此代码后，将创建一个名为TestPage.txt的文件，其中包含p1的内容。然后，该文件将被读取到结构p2中，并将其Body元素打印到屏幕上。</p> <p>您可以这样编译和运行程序：</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>$ go build wiki.go
$ ./wiki
This is a sample Page.
</code></pre></div><p>（如果您使用的是Windows，则必须键入不带“./”的“wiki”才能运行程序。）</p> <p>wiki.Go完整代码:</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token comment">// Copyright 2010 The Go Authors. All rights reserved.</span>
<span class="token comment">// Use of this source code is governed by a BSD-style</span>
<span class="token comment">// license that can be found in the LICENSE file.</span>

<span class="token comment">// +build ignore</span>

<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;fmt&quot;</span>
 <span class="token string">&quot;io/ioutil&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Page <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Title <span class="token builtin">string</span>
 Body  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Page<span class="token punctuation">)</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
 filename <span class="token operator">:=</span> p<span class="token punctuation">.</span>Title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
 <span class="token keyword">return</span> ioutil<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Body<span class="token punctuation">,</span> <span class="token number">0600</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Page<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 filename <span class="token operator">:=</span> title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
 body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> body<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 p1 <span class="token operator">:=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> <span class="token string">&quot;TestPage&quot;</span><span class="token punctuation">,</span> Body<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;This is a sample Page.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
 p1<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 p2<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span><span class="token string">&quot;TestPage&quot;</span><span class="token punctuation">)</span>
 fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="net-http软件包介绍-插叙"><a href="#net-http软件包介绍-插叙" class="header-anchor">#</a> net/http软件包介绍（插叙）</h4> <p>以下是一个简单web服务器的完整工作示例：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token comment">// +build ignore</span>

<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;log&quot;</span>
    <span class="token string">&quot;net/http&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">handler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;Hi there, I love %s!&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>main函数以对http.HandleFunc的调用开始，该调用告诉http包使用处理程序处理对web根（“/”）的所有请求。</p> <p>然后，它调用http.ListenAndServe，指定它应该侦听任何接口上的端口8080（“：8080”）。（现在不要担心它的第二个参数nil。）这个函数将被阻塞，直到程序终止。</p> <p>ListenAndServe总是返回一个错误，因为它只有在发生意外错误时才会返回。为了记录这个错误，我们用log.Fatal包装函数调用。</p> <p>函数处理程序的类型为http.HandlerFunc。它以http.ResponseWriter和http.Request作为参数。</p> <p>http.ResponseWriter值汇编http服务器的响应；通过写入它，我们将数据发送到HTTP客户端。</p> <p>http.Request是一种表示客户端http请求的数据结构。r.URL.Path是请求URL的路径组件。尾部[1:]的意思是“创建从第一个字符到最后的Path的子片段。”这将删除路径名称中的前导“/”。</p> <p>如果您运行此程序并访问URL：<a href="http://localhost:8080/monkeys" target="_blank" rel="noopener noreferrer">http://localhost:8080/monkeys<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
该程序将呈现一个页面，该页面包含：</p> <div class="language-html extra-class"><pre class="language-html"><code>该程序将呈现一个页面，该页面包含：
</code></pre></div><h4 id="使用net-http为wiki页面提供服务"><a href="#使用net-http为wiki页面提供服务" class="header-anchor">#</a> 使用net/http为wiki页面提供服务</h4> <p>要使用net/http包，必须导入该包：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;fmt&quot;</span>
 <span class="token string">&quot;io/ioutil&quot;</span>
 <span class="token string">&quot;log&quot;</span>
 <span class="token string">&quot;net/http&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>让我们创建一个处理程序viewHandler，它将允许用户查看wiki页面。它将处理前缀为“/view/”的URL。</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">viewHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    p<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;&lt;h1&gt;%s&lt;/h1&gt;&lt;div&gt;%s&lt;/div&gt;&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>Title<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再次注意，使用_可以忽略loadPage中的错误返回值。这里这样做是为了简单，通常被认为是不好的做法。我们稍后会处理这个问题。</p> <p>首先，此函数从请求URL的路径组件r.URL.Path中提取页面标题。使用[len（“/view/”）：]对Path进行重新切片，以删除请求路径的前导“/view/”组件。这是因为路径总是以“/view/”开头，这不是页面标题的一部分。</p> <p>然后，该函数加载页面数据，用一个简单的HTML字符串格式化页面，并将其写入http.ResponseWriter w。</p> <p>为了使用这个处理程序，我们重写了主函数来初始化http，使用viewHandler来处理路径/view/下的任何请求。</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">,</span> viewHandler<span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们迄今为止编写的代码:</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token comment">// Copyright 2010 The Go Authors. All rights reserved.</span>
<span class="token comment">// Use of this source code is governed by a BSD-style</span>
<span class="token comment">// license that can be found in the LICENSE file.</span>

<span class="token comment">// +build ignore</span>

<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;fmt&quot;</span>
 <span class="token string">&quot;io/ioutil&quot;</span>
 <span class="token string">&quot;log&quot;</span>
 <span class="token string">&quot;net/http&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Page <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Title <span class="token builtin">string</span>
 Body  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Page<span class="token punctuation">)</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
 filename <span class="token operator">:=</span> p<span class="token punctuation">.</span>Title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
 <span class="token keyword">return</span> ioutil<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Body<span class="token punctuation">,</span> <span class="token number">0600</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Page<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 filename <span class="token operator">:=</span> title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
 body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> body<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">viewHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
 p<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
 fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;&lt;h1&gt;%s&lt;/h1&gt;&lt;div&gt;%s&lt;/div&gt;&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>Title<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">,</span> viewHandler<span class="token punctuation">)</span>
 log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>让我们创建一些页面数据（作为test.txt），编译我们的代码，并尝试提供wiki页面。</p> <p>在编辑器中打开test.txt文件，并在其中保存字符串“Hello world”（不带引号）。</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>go build wiki.go
./wiki
</code></pre></div><p>（如果您使用的是Windows，则必须键入不带“./”的“wiki”才能运行程序。）</p> <p>在运行此web服务器的情况下，访问<a href="http://localhost:8080/view/test%E5%BA%94%E8%AF%A5%E6%98%BE%E7%A4%BA%E4%B8%80%E4%B8%AA%E6%A0%87%E9%A2%98%E4%B8%BA%E2%80%9Ctest%E2%80%9D%E7%9A%84%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%85%B6%E4%B8%AD%E5%8C%85%E5%90%AB%E5%8D%95%E8%AF%8D%E2%80%9CHello" target="_blank" rel="noopener noreferrer">http://localhost:8080/view/test应该显示一个标题为“test”的页面，其中包含单词“Hello<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> world”。</p> <h4 id="编辑页面"><a href="#编辑页面" class="header-anchor">#</a> 编辑页面</h4> <p>wiki不是没有编辑页面功能的wiki。让我们创建两个新的处理程序：一个名为editHandler的处理程序用于显示“编辑页面”表单，另一个名的saveHandler用于保存通过表单输入的数据。</p> <p>首先，我们将它们添加到main（）中：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">,</span> viewHandler<span class="token punctuation">)</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/edit/&quot;</span><span class="token punctuation">,</span> editHandler<span class="token punctuation">)</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/save/&quot;</span><span class="token punctuation">,</span> saveHandler<span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数editHandler加载页面（或者，如果不存在，创建一个空的page结构），并显示一个HTML表单。</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">editHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/edit/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        p <span class="token operator">=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;&lt;h1&gt;Editing %s&lt;/h1&gt;&quot;</span><span class="token operator">+</span>
        <span class="token string">&quot;&lt;form action=\&quot;/save/%s\&quot; method=\&quot;POST\&quot;&gt;&quot;</span><span class="token operator">+</span>
        <span class="token string">&quot;&lt;textarea name=\&quot;body\&quot;&gt;%s&lt;/textarea&gt;&lt;br&gt;&quot;</span><span class="token operator">+</span>
        <span class="token string">&quot;&lt;input type=\&quot;submit\&quot; value=\&quot;Save\&quot;&gt;&quot;</span><span class="token operator">+</span>
        <span class="token string">&quot;&lt;/form&gt;&quot;</span><span class="token punctuation">,</span>
        p<span class="token punctuation">.</span>Title<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Title<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个函数可以很好地工作，但所有硬编码的HTML都很难看。当然，还有更好的方法。</p> <h4 id="html-template包"><a href="#html-template包" class="header-anchor">#</a> html/template包</h4> <p>html/template包是Go标准库的一部分。我们可以使用html/template将html保存在一个单独的文件中，这样我们就可以在不修改底层Go代码的情况下更改编辑页面的布局。</p> <p>首先，我们必须将html/template添加到导入列表中。我们也不会再使用fmt了，所以我们必须删除它。</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;html/template&quot;</span>
 <span class="token string">&quot;io/ioutil&quot;</span>
 <span class="token string">&quot;net/http&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>让我们创建一个包含HTML表单的模板文件。打开一个名为edit.HTML的新文件，并添加以下行：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Editing {{.Title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/save/{{.Title}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>body<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>80<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{printf &quot;%s&quot; .Body}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Save<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>修改editHandler以使用模板，而不是硬编码的HTML：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">editHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/edit/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        p <span class="token operator">=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;edit.html&quot;</span><span class="token punctuation">)</span>
    t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数template.ParseFiles将读取edit.html的内容并返回一个*template.template。</p> <p>方法t.Execute执行模板，将生成的HTML写入http.ResponseWriter。.Title和.Body虚线标识符指的是p.Title和p.Body。</p> <p>模板指令用双大括号括起来。printf“%s”.Body指令是一个函数调用，它将.Body输出为字符串，而不是字节流，这与对fmt.printf的调用相同。html/template包有助于确保模板操作只生成安全且外观正确的html。例如，它会自动转义任何大于号（&gt;）的符号，将其替换为&amp;gt；，以确保用户数据不会损坏表单HTML。</p> <p>既然我们现在正在使用模板，那么让我们为我们的viewHandler创建一个名为view.html的模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{.Title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>[<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/edit/{{.Title}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{printf &quot;%s&quot; .Body}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>相应地修改viewHandler：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">viewHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    p<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;view.html&quot;</span><span class="token punctuation">)</span>
    t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>请注意，我们在两个处理程序中使用了几乎完全相同的模板代码。让我们通过将模板代码移动到它自己的函数来消除这种重复：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> tmpl <span class="token builtin">string</span><span class="token punctuation">,</span> p <span class="token operator">*</span>Page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span>tmpl <span class="token operator">+</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">)</span>
    t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>并修改处理程序以使用该函数：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">viewHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    p<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">editHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/edit/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        p <span class="token operator">=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果我们在main中注释掉未实现的保存处理程序的注册，我们可以再次构建和测试我们的程序。
看我们迄今为止编写的代码。</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token comment">// Copyright 2010 The Go Authors. All rights reserved.</span>
<span class="token comment">// Use of this source code is governed by a BSD-style</span>
<span class="token comment">// license that can be found in the LICENSE file.</span>

<span class="token comment">// +build ignore</span>

<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;html/template&quot;</span>
 <span class="token string">&quot;io/ioutil&quot;</span>
 <span class="token string">&quot;log&quot;</span>
 <span class="token string">&quot;net/http&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Page <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Title <span class="token builtin">string</span>
 Body  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Page<span class="token punctuation">)</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
 filename <span class="token operator">:=</span> p<span class="token punctuation">.</span>Title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
 <span class="token keyword">return</span> ioutil<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Body<span class="token punctuation">,</span> <span class="token number">0600</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Page<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 filename <span class="token operator">:=</span> title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
 body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> body<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> tmpl <span class="token builtin">string</span><span class="token punctuation">,</span> p <span class="token operator">*</span>Page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span>tmpl <span class="token operator">+</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">)</span>
 t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">viewHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
 p<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
 <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">editHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/edit/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
 p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  p <span class="token operator">=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">,</span> viewHandler<span class="token punctuation">)</span>
 http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/edit/&quot;</span><span class="token punctuation">,</span> editHandler<span class="token punctuation">)</span>
 <span class="token comment">//http.HandleFunc(&quot;/save/&quot;, saveHandler)</span>
 log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="处理不存在的页面"><a href="#处理不存在的页面" class="header-anchor">#</a> 处理不存在的页面</h4> <p>如果您访问/view/APageThatDesntExist会怎样？您将看到一个包含HTML的页面。这是因为它忽略了loadPage的错误返回值，并继续尝试在没有数据的情况下填写模板。相反，如果请求的页面不存在，它应该将客户端重定向到编辑页面，以便创建内容：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">viewHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;/edit/&quot;</span><span class="token operator">+</span>title<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>http.RRedirect函数将http.StatusFind（302）的http状态代码和Location标头添加到http响应中。</p> <h4 id="保存页面"><a href="#保存页面" class="header-anchor">#</a> 保存页面</h4> <p>函数saveHandler将处理位于编辑页面上的表单的提交。在main中取消注释相关行之后，让我们实现处理程序：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">saveHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/save/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    body <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">FormValue</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span>
    p <span class="token operator">:=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">}</span>
    p<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    http<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;/view/&quot;</span><span class="token operator">+</span>title<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>页面标题（在URL中提供）和表单的唯一字段Body存储在一个新页面中。然后调用save（）方法将数据写入文件，并将客户端重定向到/view/page。</p> <p>FormValue返回的值的类型为字符串。我们必须将该值转换为  []byte ，然后才能将其放入Page结构中。我们使用 []byte（body）来执行转换。</p> <h4 id="错误处理"><a href="#错误处理" class="header-anchor">#</a> 错误处理</h4> <p>在我们的程序中，有几个地方的错误被忽略了。这是一种糟糕的做法，尤其是因为当错误发生时，程序会有意外的行为。更好的解决方案是处理错误并向用户返回错误消息。这样，如果出现问题，服务器将按照我们想要的方式运行，并可以通知用户。</p> <p>首先，让我们处理renderTemplate中的错误：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> tmpl <span class="token builtin">string</span><span class="token punctuation">,</span> p <span class="token operator">*</span>Page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">,</span> err <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span>tmpl <span class="token operator">+</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    err <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>http.Error函数发送指定的http响应代码（在本例中为“内部服务器错误”）和错误消息。把它放在一个单独的功能中的决定已经取得了成效。</p> <p>现在让我们修复saveHandler：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">saveHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">&quot;/save/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    body <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">FormValue</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span>
    p <span class="token operator">:=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">}</span>
    err <span class="token operator">:=</span> p<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    http<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;/view/&quot;</span><span class="token operator">+</span>title<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在p.save（）过程中发生的任何错误都将报告给用户。</p> <h4 id="模板缓存"><a href="#模板缓存" class="header-anchor">#</a> 模板缓存</h4> <p>这段代码效率低下：每次渲染页面时，renderTemplate都会调用ParseFiles。更好的方法是在程序初始化时调用ParseFiles一次，将所有模板解析为一个*Template。然后我们可以使用ExecuteTemplate方法来渲染特定的模板。</p> <p>首先，我们创建一个名为templates的全局变量，并使用ParseFiles对其进行初始化。</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> templates <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;edit.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;view.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>函数template.Must是一个方便的包装器，当传递非nil错误值时会死机，否则会原封不动地返回*template。恐慌在这里是恰当的；如果模板无法加载，那么唯一明智的做法就是退出程序。</p> <p>ParseFiles函数采用任意数量的字符串参数来标识模板文件，并将这些文件解析为以基本文件名命名的模板。如果我们要在程序中添加更多的模板，我们会将它们的名称添加到ParseFiles调用的参数中。</p> <p>然后，我们修改renderTemplate函数以调用templates.ExecuteTemplate方法，该方法具有相应模板的名称：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> tmpl <span class="token builtin">string</span><span class="token punctuation">,</span> p <span class="token operator">*</span>Page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    err <span class="token operator">:=</span> templates<span class="token punctuation">.</span><span class="token function">ExecuteTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> tmpl<span class="token operator">+</span><span class="token string">&quot;.html&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>请注意，模板名称是模板文件名，因此我们必须将“.html”附加到tmpl参数。</p> <h4 id="验证"><a href="#验证" class="header-anchor">#</a> 验证</h4> <p>正如您可能已经观察到的，这个程序有一个严重的安全缺陷：用户可以在服务器上提供要读/写的任意路径。为了缓解这种情况，我们可以编写一个函数，用正则表达式验证标题。</p> <p>首先，将“regexp”添加到导入列表中。然后，我们可以创建一个全局变量来存储验证表达式：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> validPath <span class="token operator">=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">&quot;^/(edit|save|view)/([a-zA-Z0-9]+)$&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>函数regexp.MustCompile将解析和编译正则表达式，并返回regexp.regexp。MustCompile与compile的不同之处在于，如果表达式编译失败，它将死机，而compile将返回一个错误作为第二个参数。</p> <p>现在，让我们编写一个函数，使用validPath表达式验证路径并提取页面标题：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">getTitle</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m <span class="token operator">:=</span> validPath<span class="token punctuation">.</span><span class="token function">FindStringSubmatch</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
    <span class="token keyword">if</span> m <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;invalid Page Title&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">nil</span> <span class="token comment">// The title is the second subexpression.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果标题是有效的，那么它将与一个nil错误值一起返回。如果标题无效，函数将向HTTP连接写入一个“404未找到”错误，并向处理程序返回一个错误。要创建新的错误，我们必须导入错误包。</p> <p>让我们在每个处理程序中调用getTitle：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">viewHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getTitle</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;/edit/&quot;</span><span class="token operator">+</span>title<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">editHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getTitle</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        p <span class="token operator">=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">saveHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getTitle</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    body <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">FormValue</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span>
    p <span class="token operator">:=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">}</span>
    err <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    http<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;/view/&quot;</span><span class="token operator">+</span>title<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="介绍函数文字和闭包"><a href="#介绍函数文字和闭包" class="header-anchor">#</a> 介绍函数文字和闭包</h4> <p>在每个处理程序中捕捉错误条件会引入大量重复的代码。如果我们可以将每个处理程序封装在一个函数中进行验证和错误检查，会怎么样？Go的函数文字提供了一种强大的功能抽象方法，可以在这里为我们提供帮助。</p> <p>首先，我们重写每个处理程序的函数定义，以接受一个标题字符串：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">viewHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> title <span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function">editHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> title <span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function">saveHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> title <span class="token builtin">string</span><span class="token punctuation">)</span>
</code></pre></div><p>现在，让我们定义一个包装函数，它接受上面类型的函数，并返回http.HandlerFunc类型的函数（适合传递给函数http.HandleFunc）：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">makeHandler</span><span class="token punctuation">(</span>fn <span class="token keyword">func</span> <span class="token punctuation">(</span>http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Here we will extract the page title from the Request,</span>
  <span class="token comment">// and call the provided handler 'fn'</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>返回的函数被称为闭包，因为它包含了在其外部定义的值。在这种情况下，变量fn（makeHandler的单个参数）被闭包包围。变量fn将是我们的保存、编辑或视图处理程序之一。</p> <p>现在我们可以从getTitle中获取代码并在这里使用它（经过一些小的修改）：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">makeHandler</span><span class="token punctuation">(</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        m <span class="token operator">:=</span> validPath<span class="token punctuation">.</span><span class="token function">FindStringSubmatch</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
        <span class="token keyword">if</span> m <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            http<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token function">fn</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>makeHandler返回的闭包是一个使用http.ResponseWriter和http.Request（换句话说，http.HandlerFunc）的函数。闭包从请求路径中提取标题，并使用validPath regexp进行验证。如果标题无效，将使用http.NotFound函数向ResponseWriter写入一个错误。如果标题有效，则将调用包含的处理程序函数fn，并将ResponseWriter、Request和title作为参数。</p> <p>现在，我们可以在使用http包注册处理程序函数之前，将处理程序函数主要包装为makeHandler：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">,</span> <span class="token function">makeHandler</span><span class="token punctuation">(</span>viewHandler<span class="token punctuation">)</span><span class="token punctuation">)</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/edit/&quot;</span><span class="token punctuation">,</span> <span class="token function">makeHandler</span><span class="token punctuation">(</span>editHandler<span class="token punctuation">)</span><span class="token punctuation">)</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/save/&quot;</span><span class="token punctuation">,</span> <span class="token function">makeHandler</span><span class="token punctuation">(</span>saveHandler<span class="token punctuation">)</span><span class="token punctuation">)</span>

    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后，我们从处理程序函数中删除了对getTitle的调用，使它们更加简单：</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">viewHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;/edit/&quot;</span><span class="token operator">+</span>title<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">editHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        p <span class="token operator">=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">saveHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    body <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">FormValue</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span>
    p <span class="token operator">:=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">}</span>
    err <span class="token operator">:=</span> p<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    http<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;/view/&quot;</span><span class="token operator">+</span>title<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="试试看"><a href="#试试看" class="header-anchor">#</a> 试试看</h4> <p>查看最终代码列表:</p> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token comment">// Copyright 2010 The Go Authors. All rights reserved.</span>
<span class="token comment">// Use of this source code is governed by a BSD-style</span>
<span class="token comment">// license that can be found in the LICENSE file.</span>

<span class="token comment">// +build ignore</span>

<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;html/template&quot;</span>
 <span class="token string">&quot;io/ioutil&quot;</span>
 <span class="token string">&quot;log&quot;</span>
 <span class="token string">&quot;net/http&quot;</span>
 <span class="token string">&quot;regexp&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Page <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Title <span class="token builtin">string</span>
 Body  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Page<span class="token punctuation">)</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
 filename <span class="token operator">:=</span> p<span class="token punctuation">.</span>Title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
 <span class="token keyword">return</span> ioutil<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Body<span class="token punctuation">,</span> <span class="token number">0600</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Page<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 filename <span class="token operator">:=</span> title <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span>
 body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> body<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">viewHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  http<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;/edit/&quot;</span><span class="token operator">+</span>title<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">)</span>
  <span class="token keyword">return</span>
 <span class="token punctuation">}</span>
 <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">editHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 p<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">loadPage</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  p <span class="token operator">=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">saveHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> title <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 body <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">FormValue</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span>
 p <span class="token operator">:=</span> <span class="token operator">&amp;</span>Page<span class="token punctuation">{</span>Title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> Body<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">}</span>
 err <span class="token operator">:=</span> p<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
  <span class="token keyword">return</span>
 <span class="token punctuation">}</span>
 http<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;/view/&quot;</span><span class="token operator">+</span>title<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusFound<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> templates <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;edit.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;view.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">renderTemplate</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> tmpl <span class="token builtin">string</span><span class="token punctuation">,</span> p <span class="token operator">*</span>Page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 err <span class="token operator">:=</span> templates<span class="token punctuation">.</span><span class="token function">ExecuteTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> tmpl<span class="token operator">+</span><span class="token string">&quot;.html&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> validPath <span class="token operator">=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">&quot;^/(edit|save|view)/([a-zA-Z0-9]+)$&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">makeHandler</span><span class="token punctuation">(</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  m <span class="token operator">:=</span> validPath<span class="token punctuation">.</span><span class="token function">FindStringSubmatch</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
  <span class="token keyword">if</span> m <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   http<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
   <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token function">fn</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/view/&quot;</span><span class="token punctuation">,</span> <span class="token function">makeHandler</span><span class="token punctuation">(</span>viewHandler<span class="token punctuation">)</span><span class="token punctuation">)</span>
 http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/edit/&quot;</span><span class="token punctuation">,</span> <span class="token function">makeHandler</span><span class="token punctuation">(</span>editHandler<span class="token punctuation">)</span><span class="token punctuation">)</span>
 http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/save/&quot;</span><span class="token punctuation">,</span> <span class="token function">makeHandler</span><span class="token punctuation">(</span>saveHandler<span class="token punctuation">)</span><span class="token punctuation">)</span>

 log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>重新编译代码，然后运行应用程序：</p> <div class="language-Shell extra-class"><pre class="language-shell"><code>go build wiki.go
./wiki
</code></pre></div><p>浏览 <a href="http://localhost:8080/view/ANewPage" target="_blank" rel="noopener noreferrer">http://localhost:8080/view/ANewPage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 应该会向您显示页面编辑表单。然后您应该能够输入一些文本，单击“保存”，然后被重定向到新创建的页面。&gt;</p> <h4 id="其他任务"><a href="#其他任务" class="header-anchor">#</a> 其他任务</h4> <p>以下是一些你可能想自己解决的简单任务：</p> <ul><li>将模板存储在tmpl/中，将页面数据存储在data/中。</li> <li>添加一个处理程序，使网站根重定向到/viewFrontPage。</li> <li>通过使页面模板成为有效的HTML并添加一些CSS规则来扩充页面模板。</li> <li>通过将[PageName]的实例转换为 <code>&lt;a href=“/view/PageName”&gt;页面名称&lt;/a&gt;</code>。（提示：您可以使用regexp.ReplaceAllFunc来执行此操作）</li></ul></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/GoTour/004/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">教程：使用Go和Gin开发RESTful API</div></a> <a href="/pages/python/PyAutoGui/001/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">01.Windows11下PyAutoGui的安装和使用</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/GoTour/004/" class="prev">教程：使用Go和Gin开发RESTful API</a></span> <span class="next"><a href="/pages/python/PyAutoGui/001/">01.Windows11下PyAutoGui的安装和使用</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:qingshansima@outlook.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/qingshansima" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
    Copyright © 2024-2023
    <span>飞翔的土肥猿 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7d1116cd.js" defer></script><script src="/assets/js/2.f6c26bfc.js" defer></script><script src="/assets/js/3.7a437186.js" defer></script><script src="/assets/js/23.d4182788.js" defer></script>
  </body>
</html>
